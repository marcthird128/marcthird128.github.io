<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="A Minecraft server that supports Eaglercraft 1.8 and 1.12">
    <link rel="icon" type="image/x-icon" href="../source/icon.png" />
    <link rel="stylesheet" href="../source/css/main.css" />
    <link rel="stylesheet" href="../source/css/admin.css" />
    <title>Mazarca Admin | File viewer</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        #content {
            font-family: monospace;
            font-size: 12px;
            background: #000000;
            height: 100%;
            resize: none;
            scrollbar-width: thin;
            scrollbar-color: #323232 black;
        }
    </style>
    <script src="../source/js/auth.js"></script>
</head>
<body>
    <main class="wrapper wrapper-full">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%; flex: 1">
            <h1 class="text-center no-margin">File Viewer</h1>
            <textarea id="content"></textarea>
            <form class="nav-btn footer">
                <a href="console.html" title="Console">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="#ffffff" d="M16 18a1 1 0 1 0 0-2zm-8-2a1 1 0 1 0 0 2zm.707-8.707a1 1 0 1 0-1.414 1.414zM11 11l.707.707a1 1 0 0 0 0-1.414zm-3.707 2.293a1 1 0 1 0 1.414 1.414zM7 4h10V2H7zm13 3v10h2V7zm-3 13H7v2h10zM4 17V7H2v10zm3 3a3 3 0 0 1-3-3H2a5 5 0 0 0 5 5zm13-3a3 3 0 0 1-3 3v2a5 5 0 0 0 5-5zM17 4a3 3 0 0 1 3 3h2a5 5 0 0 0-5-5zM7 2a5 5 0 0 0-5 5h2a3 3 0 0 1 3-3zm9 14H8v2h8zM7.293 8.707l3 3l1.414-1.414l-3-3zm3 1.586l-3 3l1.414 1.414l3-3z"/>
                    </svg>
                </a>
                <input disabled type="text" id="pathname">
                <button disabled title="Not finished yet!" class="primary" type="submit" id="save-btn">Save</button>
            </form>
        </div>
    </main>
    <script>
        const knownText = ["txt", "yml", "yaml", "json", "bat"];
        const fileContent = document.getElementById("content");
        const filePathName = document.getElementById("pathname");
        const url = new URL(location.href);
        let host = url.searchParams.get("host");
        let file = url.searchParams.get("file");

        async function loadTextFile() {
            if (file && host) {
                host = decodeURIComponent(host);
                file = decodeURIComponent(file);
                try {
                    const fileName = file.split("/").at(-1);
                    const ext = fileName?.split(".").at(-1)?.toLowerCase();
                    if (ext && knownText.includes(ext)) {
                        filePathName.value = `[${host}] ${file}`;
                        let res = await authenticatedFetch(`https://${host}.maza64.xyz${file}`);
                        let textContent = await res.text();
                        fileContent.value = textContent;
                    } else {
                        alert("Requested file is not a known text format.");
                    };
                } catch (err) {
                    alert(err);
                };
            } else {
                alert("Missing required 'host' and/or 'file' parameter(s)!");
            };
        };

        loadTextFile();
    </script>
</body>
</html>
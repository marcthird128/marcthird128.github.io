<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../source/css/stats.css">
    <title>Server Stats</title>
    <script src="../source/js/auth.js"></script>
</head>
<body>
    <main>
        <div>
            <div>
                <header>
                    <h2>Raspberry Pi</h2>
                    <hr size="1px">
                </header>
                <div class="stats" id="raspberrypi"></div>
            </div>
            <div>
                <header>
                    <h2>New Laptop</h2>
                    <hr size="1px">
                </header>
                <div class="stats" id="newlaptop"></div>
            </div>
            <div>
                <header>
                    <h2>Gaming PC</h2>
                    <hr size="1px">
                </header>
                <div class="stats" id="marcomen"></div>
            </div>
            <div>
                <header>
                    <h2>Old PC</h2>
                    <hr size="1px">
                </header>
                <div class="stats" id="oldpc"></div>
            </div>
        </div>
    </main>
    <script>
        async function getStats(host) {
            const statsContainer = document.getElementById(host);
            statsContainer.innerHTML = `<p class="text-center">Loading...</p>`;
            try {
                let res = await authenticatedFetch(`https://${host}.maza64.xyz/info`);
                let stats = await res.json();
                statsContainer.innerHTML = `
                    <p><b>Hostname:</b> <span>${stats.hostname}</span></p>
                    <p><b>Platform:</b> <span>${stats.platform}</span></p>
                    <p><b>Architecture:</b> <span>${stats.arch}</span></p>
                    <p><b>OS Version:</b> <span>${stats.osVersion}</span></p>
                    <p><b>Uptime:</b> <span>${stats.uptimeHours} hours (${stats.uptimeSeconds} s)</span></p>
                    <p><b>CPU:</b> <span>${stats.cpu.model} (${stats.cpu.cores} cores)</span></p>
                    <p><b>CPU Speed:</b> <span>${stats.cpu.speed} MHz</span></p>
                    <p><b>CPU Load:</b> <span>${stats.cpu.load1m}, ${stats.cpu.load5m}, ${stats.cpu.load15m}</span></p>
                    <p><b>Total RAM:</b> <span>${(stats.memory.total / (1024*1024)).toFixed(2)} MB</span></p>
                    <p><b>Used RAM:</b> <span>${(stats.memory.used / (1024*1024)).toFixed(2)} MB (${stats.memory.usagePercent}%)</span></p>
                    <p><b>Free RAM:</b> <span>${(stats.memory.free / (1024*1024)).toFixed(2)} MB</span></p>
                    <p><b>Temp Directory:</b> <span>${stats.tempDir}</span></p>
                    <p><b>NodeJS Version:</b> <span>${stats.nodeVersion}</span></p>
                    <p><b>Server Time:</b> <span>${stats.serverTime}</span></p>
                    <p><b>Listener Port:</b> <span>${stats.port}</span></p>
                `;
            } catch (err) {
                console.error(`Failed to load stats for '${host}'! ${err}`);
                statsContainer.innerHTML = `<p class="text-center">Not available.</p>`;
            };
        };

        getStats("raspberrypi");
        getStats("newlaptop");
        getStats("marcomen");
        getStats("oldpc");
    </script>
</body>
</html>